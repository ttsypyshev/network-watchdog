# Cкрипта мониторинга интернет-соединения

Этот скрипт мониторит доступность интернета на сервере и отправляет уведомления в Telegram, когда происходит изменение состояния подключения (например, потеря связи или восстановление интернета). Скрипт использует переменные из `.env` файла для настройки и отправки уведомлений.

## Требования

1. **Операционная система**: Скрипт предназначен для работы в средах Linux.
2. **Библиотеки**:
   - `curl` для отправки запросов к API Telegram.
   - `ping` для проверки доступности DNS серверов.
   - `ip` и `iw` для получения информации о сетевых интерфейсах.
3. **Telegram Bot**: Для работы скрипта необходимо создать бота в Telegram через BotFather и получить его токен.

## Настройка

### 1. Создание бота в Telegram

- Откройте Telegram и найдите пользователя `BotFather`.
- Отправьте команду `/newbot`, следуйте инструкциям, чтобы создать нового бота.
- Получите **BOT_TOKEN** для вашего бота.

### 2. Создание `.env` файла

Создайте файл `.env` в той же директории, где находится скрипт, и добавьте в него следующие переменные:

```
BOT_TOKEN=your_bot_token
CHAT_IDS=("chat_id_1" "chat_id_2" "chat_id_3")
```

- Замените `your_bot_token` на токен, полученный от BotFather.
- Замените `chat_id_1`, `chat_id_2`, `chat_id_3` на `chat_id` пользователей или групп в Telegram, которым вы хотите отправлять уведомления.

Вы можете получить `chat_id`, написав вашему боту и посмотрев ответ в `https://api.telegram.org/bot<your_bot_token>/getUpdates`.

### 3. Установка необходимых инструментов

На сервере должны быть установлены следующие утилиты:
- `curl` для отправки HTTP запросов.
- `ping` для проверки доступности DNS серверов.
- `ip` и `iw` для получения информации о сетевых интерфейсах.

## Использование

1. Скачайте или создайте файл скрипта, например `network_watchdog.sh`.
2. Сделайте скрипт исполняемым:

   ```bash
   chmod +x network_watchdog.sh
   ```

3. Запустите скрипт:

   ```bash
   ./network_watchdog.sh
   ```

Скрипт будет бесконечно работать в фоновом режиме, проверяя доступность интернета каждые 10 секунд. При изменении состояния подключения будет отправляться уведомление в Telegram.

## Логирование

Все события (подключение, отключение интернета, изменения сети) логируются в файл `network_watchdog.log`. Это позволяет отслеживать историю работы скрипта.

Пример логов:
```
2025-03-16 10:00:01 - [info] - Интернет восстановлен. Время простоя: 00:03:25. Подключение: 192.168.0.1/24 (Проводное)
2025-03-16 10:01:23 - [err] - Ошибка пинга к серверу 8.8.8.8. Сервер недоступен.
```

## Ожидаемые уведомления

- **Интернет подключен**: Уведомление о восстановлении интернет-соединения.
- **Интернет отключен**: Уведомление о потере интернет-соединения.
- **Изменение сети**: Уведомление о смене сети (например, переход с проводного на беспроводное соединение).

## Настройки

- `DNS_SERVERS`: Массив DNS серверов для пинга (по умолчанию используются 8.8.8.8 и 1.1.1.1).
- `CHECK_INTERVAL`: Интервал проверки доступности интернета в секундах (по умолчанию 10 секунд).
- `LOG_FILE`: Файл для записи логов (по умолчанию `network_watchdog.log`).

## Примечания

- Скрипт использует проверки пинга для определения доступности интернета. Если один из серверов доступен, считается, что интернет подключен.
- Скрипт отслеживает как проводные, так и беспроводные подключения. В случае смены сети будет отправлено уведомление.
